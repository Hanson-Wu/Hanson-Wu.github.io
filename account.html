<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
      <title>PalaSearch</title>
      <link href="../css/bootstrap.min.css" rel="stylesheet">
      <link href="../font-awesome/css/font-awesome.css" rel="stylesheet">
      <link href="../css/animate.css" rel="stylesheet">
      <link href="../css/style.css" rel="stylesheet">
   </head>
   <body>
      <div id="wrapper">
      <nav class="navbar-default navbar-static-side fixed-side" role="navigation">
         <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
               <li class="nav-header logo-nav">
                  <div class="profile-element text-center">
                     <span>
                     <a href="index.html"><img alt="image" class="logo-style" src="../img/logo.png" /></a>
                     </span>
                  </div>
                  <div class="logo-element">
                     PLS
                  </div>
               </li>
               <li>
                     <a href="search.html"><i class="fa fa-search"></i> <span class="nav-label">搜索</span></a>
                  </li>
                  <li>
                     <a href="add.html"><i class="fa fa-pencil-square-o"></i> <span class="nav-label">归档</span></a>
                  </li>
                  <li>
                     <a href="tag_share.html"><i class="fa fa-share-square-o"></i> <span class="nav-label">分享</span></a>
                  </li>
                  <li>
                     <a href="visualization.html"><i class="fa fa-bar-chart"></i> <span class="nav-label">可视化</span></a>
                  </li>
                  <li>
                     <a href="tag_management.html"><i class="fa fa-tags"></i> <span class="nav-label">标签</span></a>
                  </li>
                  <li>
                     <a href="documents.html"><i class="fa fa-file-text-o"></i> <span class="nav-label">文档</span></a>
                  </li>
                  <li>
                     <a href="messages.html"><i class="fa fa-bell"></i> <span class="nav-label">消息</span></a>
                  </li>
                  <li class="active">
                     <a href="account.html"><i class="fa fa-user"></i> <span class="nav-label">账号信息</span></a>
                  </li>
                  <li>
                     <a href="login.html"><i class="fa fa-sign-out"></i> <span class="nav-label">登出</span></a>
                  </li>
            </ul>
         </div>
      </nav>
      <div id="page-wrapper" class="gray-bg">
         <div class="row border-bottom">
            <nav class="navbar navbar-fixed-top top-m-left" role="navigation" style="margin-bottom: 0">
               <div class="navbar-header">
                  <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
               </div>
               <div class="user-info-top">
                  <ul class="nav navbar-top-links">
                     <li>
                        <span class="m-t-md text-muted welcome-message">欢迎使用PalaSearch.</span>
                     </li>
                     <li>
                        <a href="account.html">
                        <i class="fa fa-user"></i> <span class="text-navy " id="usr-name"></span>
                        </a>
                     </li>
                  </ul>
               </div>
               <ul class="nav navbar-top-links pull-right xs-right-mag">
                  <li>
                     <button id="fontResize" class="btn btn-primary btn-outline btn-sm m-t m-l-xs" type="button"><i class="fa fa-font"></i> <span class="xs-hide">文字大小</span></button>              
                  </li>
                  <li>
                     <div>
                        <a href="#topNav" class="btn btn-primary btn-outline btn-xs m-t top-a m-l-xs" type="button"><i class="fa fa-arrow-up"></i> <span class="xs-hide">跳至顶端</span></a>  
                     </div>
                  </li>
               </ul>
            </nav>
         </div>
         <div id="topNav" class="row wrapper border-bottom white-bg page-heading xs-no-l-mag">
            <div class="col-lg-9">
               <ol class="breadcrumb">
                  <li>
                     <a href="search.html">主页</a>
                  </li>
                  <li class="active">
                     <strong>用户账号</strong>
                  </li>
               </ol>
            </div>
         </div>
         <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
               <div class="col-lg-12">
                  <div class="ibox float-e-margins">
                     <div class="ibox-content">
                        <h1>
                           账号信息
                        </h1>
                        <h3 class="m-t-lg">目标邮箱:</h3>
                        <div class="row show-grid">
                           <div class="col-md-12" id="usr-trgt-email"></div>
                        </div>
                    <!--     <h3 class="m-t-lg">Authorized Sender: </h3> -->
                    <!--     <table class="table">
                           <thead>
                              <tr>
                                 <th width="30px">#</th>
                                 <th>Email</th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td>1</td>
                                 <td>etan@gmail.com</td>
                                 <td align="right">
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
                                 </td>
                              </tr>
                              <tr>
                                 <td>2</td>
                                 <td>etan@yahoo.com</td>
                                 <td align="right">
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
                                 </td>
                              </tr>
                              <tr>
                                 <td>3</td>
                                 <td>etan@gmail.com</td>
                                 <td align="right">
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                                    <button type="button" class="btn btn-primary btn-xs"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
                                 </td>
                              </tr>
                           </tbody>
                        </table> -->
                        <!-- message box start -->
                        <!-- <div class="alert alert-danger alert-dismissable">
                           <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                           message box. <a class="alert-link" href="#">Alert Link</a>.
                        </div> -->
                        <!-- message box end -->
                        <!-- <form role="form m-t-lg">
                           <div class="form-group">
                              <input type="email" placeholder="Add New Authorized Sender" class="form-control input-lg">
                           </div>
                           <div class="form-group">
                              <button type="button" class="btn btn-primary">ADD NEW SENDER</button>
                           </div>
                        </form> -->
                        <div class="hr-line-dashed clearfix"></div>
                        <h1>
                           基本信息
                        </h1>
                        <h3 class="m-t-lg">账号邮箱:</h3>
                        <div class="row show-grid">
                           <div class="col-md-12" id="usr-email"></div>
                        </div>
                        <h3 class="m-t-lg">姓名:</h3>
                        <div class="row show-grid">
                           <div class="col-md-12"id="usr-info-name"></div>
                        </div>
                       <!--  <button id="changeNameBtn" type="button" class="btn btn-primary">CHANGE NAME</button>
                        <form id="changeNamePan" class="row hidden">
                           <div class="col-md-6">
                              <div class="form-group">
                                 <input name="oldPass" type="text" placeholder="New name" class="form-control">
                              </div>
                              
                              <div class="alert alert-danger alert-dismissable">
                                 <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                 message box.
                              </div>
                              
                              <div class="">
                                 <button class="btn btn-primary" type="submit">Save</button>
                                 <a id="cancelNamePanBtn" class="btn btn-white" type="submit">Cancel</a>
                              </div>
                           </div>
                        </form> -->
                        <h3 class="m-t-lg">密码:</h3>
                        <button id="changePasswordBtn" type="button" class="btn btn-primary">更改密码</button>
                        <form id="changePasswordPan" class="row hidden">
                           <div class="col-md-6">
                              <div class="form-group">
                                 <input name="oldPass" required="" type="password" placeholder="旧密码..." class="form-control">
                              </div>
                              <div class="form-group">
                                 <input name="newPass" type="password" placeholder="新密码..." class="form-control">
                              </div>
                              <div class="form-group">
                                 <input name="reNewPass" type="password" placeholder="再次输入新密码..." class="form-control">
                              </div>
                              <div class="">
                                 <button class="btn btn-primary" type="submit">保存</button>
                                 <a id="cancelBtn" class="btn btn-white" type="submit">取消</a>
                              </div>
                           </div>
                        </form>
                        <!--form end-->
						<h3 class="m-t-lg">语言:</h3>
						<button id="changeLangBtn" type="button" class="btn btn-primary" onclick="location.href='https://www.palasearch.com/account.html'" >切换至英文版</button>
                     </div>
                  </div>
               </div>
            </div>
            <div class="footer">
               <div class="pull-right">
                  欢迎使用 <strong>PalaSearch</strong>.
               </div>
               <div>
                  <strong>版权所有：</strong> PalaSearch Company &copy; 2016
               </div>
            </div>
         </div>
      </div>
      <!-- Mainly scripts -->
      <script src="../js/jquery-2.1.1.js"></script>
      <script src="../js/bootstrap.min.js"></script>
      <script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
      <script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
      <!-- Custom and plugin javascript -->
      <script src="../js/inspinia.js"></script>
      <script src="../js/plugins/pace/pace.min.js"></script>
      <!-- Main javascript -->
      <script src="../js/main.js"></script>
	  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.js"></script>
	  <script src="../js/pih.js"></script>
	  <script>
         require(['js/pih/client/index','js/3rd/jquery.i18n.properties.js'], function(data){
			$.pih.loadLang();
			$.pih.api = require('js/pih/client/index');
			$.pih.api.user = new $.pih.api.UserApi();
			$.pih.api.auth = new $.pih.api.AuthApi();
			var callback = function(error, data, res) {
			  if (error) {
				$.pih.handleError(res, function(msg, field){
				  alert($.pih.i18n.prop(msg,field));
				});
			  } else {
			  console.log(data);
				$('#usr-name').html(data.name);
				$('#usr-trgt-email').html(data.receive);
				$('#usr-email').html(data.email);
				$('#usr-info-name').html(data.name);
			  }
			};
			$.pih.api.user.getInfo($.pih.getToken(), callback);
			
			var form = $('#changePasswordPan');
			form.on('submit', function(e) {
				e.preventDefault();
				var email = $("#usr-email").html();
				var pwd = $("input[name='oldPass']").val();
				var npwd = $("input[name='newPass']").val();
				var rnpwd = $("input[name='reNewPass']").val();
				
				$('.alert').remove();
				if(npwd != rnpwd){
					$.pih.createAlert($.pih.i18n.prop("auth.update.pwd.not.match")).insertBefore(form);
					return;
				}
				var callback = function(error, data, res) {
				  if (error) {
					$.pih.handleError(res, function(msg, field){
					  $.pih.createAlert($.pih.i18n.prop(msg,field)).insertBefore(form);
					});
				  } else {
					  $.pih.createSuccess($.pih.i18n.prop("auth.update.pwd.success")).insertBefore(form);
				  }
				};
				
				var req = new $.pih.api.UpdatePasswordRequest(email, pwd, npwd);
				$.pih.api.auth.updatePwd(req, callback);
			
			});
			
		});
      </script>
   </body>
</html>
